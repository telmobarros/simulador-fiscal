var app=angular.module("app",["ngRoute","ngAnimate"]);app.config(function(e,a){e.when("/",{templateUrl:"partials/index.htm",controller:"indexCtrl"}).when("/calculo",{templateUrl:"partials/calculo.htm",controller:"calculoCtrl"}).when("/resultado",{templateUrl:"partials/resultado.htm",controller:"resultadoCtrl"}).otherwise({redirectTo:"/"});a.html5Mode(!0)});
app.controller("footerCtrl",function(e,a,p,l,n,g){a.all=null;a.ano=l.current.params.ano||"2018";a.setorIRS=l.current.params.setorIRS;a.setorIRC=l.current.params.setorIRC;a.rendimentos=parseInt(l.current.params.rendimentos);a.gastos=parseInt(l.current.params.gastos);a.tipo="geral"===l.current.params.tipo||"PME"===l.current.params.tipo||"excecoes"===l.current.params.tipo?l.current.params.tipo:"geral";a.results={};a.calculateResults=function(){a.results={naoSocietario:{regimeSimplificado:{nome:"N\u00e3o Societ\u00e1ria em Regime Simplificado"},
contabilidadeOrganizada:{nome:"N\u00e3o Societ\u00e1ria em Contabilidade Organizada"}},societario:{regimeSimplificado:{nome:"Societ\u00e1ria em Regime Simplificado"},contabilidadeOrganizada:{nome:"Societ\u00e1ria em Contabilidade Organizada"}}};if(a.ano&&a.setorIRS&&a.setorIRC&&a.rendimentos&&a.gastos&&a.tipo){if(a.all){var b=a.all[a.ano].IRS,f=a.all[a.ano].IRC,h=a.all[a.ano].setores,l=a.all[a.ano].limites,e=null,k=a.results.naoSocietario.regimeSimplificado;if(a.rendimentos<=l.naoSocietario.regimeSimplificado.rendimentos){k.coeficiente=
h.IRS[a.setorIRS].coeficiente;var c=a.rendimentos*k.coeficiente;k.reducao=h.IRS[a.setorIRS].reducao;c-=c*k.reducao;k.baseImposto=c;k.baseImpostoString=g("largeNumber")(c)+"\u20ac X "+100*k.coeficiente+"% X "+100*(1-k.reducao)+"%";for(var d=0;d<b.length;d++)if(d===b.length-1||c>b[d].min&&c<=b[d].max){0===d?(k.total=c*b[d].A,k.totalString=g("largeNumber")(c)+"\u20ac X "+Math.round(1E5*b[d].A)/1E3+"%"):(k.total=b[d-1].max*b[d-1].B+(c-b[d-1].max)*b[d].A,k.escalaoAnterior=b[d-1],k.totalString=g("largeNumber")(b[d-
1].max)+"\u20ac X "+Math.round(1E5*b[d-1].B)/1E3+"% + "+g("largeNumber")(c-b[d-1].max)+"\u20ac X "+Math.round(1E5*b[d].A)/1E3+"%");k.escalao=b[d];k.total=Math.round(100*k.total)/100;break}}else k=null;k&&(e=k);var m=a.results.naoSocietario.contabilidadeOrganizada;c=a.rendimentos-a.gastos;m.baseImposto=c;m.baseImpostoString=g("largeNumber")(a.rendimentos)+"\u20ac - "+g("largeNumber")(a.gastos)+"\u20ac";for(d=0;d<b.length;d++)if(d===b.length-1||c>b[d].min&&c<=b[d].max){0===d?(m.total=c*b[d].A,m.totalString=
g("largeNumber")(c)+"\u20ac X "+Math.round(1E5*b[d].A)/1E3+"%"):(m.total=b[d-1].max*b[d-1].B+(c-b[d-1].max)*b[d].A,m.escalaoAnterior=b[d-1],m.totalString=g("largeNumber")(b[d-1].max)+"\u20ac X "+Math.round(1E5*b[d-1].B)/1E3+"% + "+g("largeNumber")(c-b[d-1].max)+"\u20ac X "+Math.round(1E5*b[d].A)/1E3+"%");m.escalao=b[d];m.total=Math.round(100*m.total)/100;break}if(!e||m&&m.total<e.total)e=m;b=a.results.societario.regimeSimplificado;a.rendimentos<=l.societario.regimeSimplificado.rendimentos?(b.coeficiente=
h.IRC[a.setorIRC].coeficiente,c=a.rendimentos*b.coeficiente,b.reducao=h.IRC[a.setorIRC].reducao,c-=c*b.reducao,b.baseImpostoString=g("largeNumber")(c)+"\u20ac X "+100*b.coeficiente+"% X "+100*(1-b.reducao)+"%",c<l.societario.regimeSimplificado.baseImposto&&(c=l.societario.regimeSimplificado.baseImposto,b.baseImpostoString=g("largeNumber")(c)+"\u20ac"),b.baseImposto=c,"geral"===a.tipo?(b.total=c*f.geral,b.totalString=g("largeNumber")(c)+"\u20ac X "+100*f.geral+"%"):"PME"===a.tipo?c>f.PME.max?(b.total=
f.PME.max*f.PME.taxa+(c-f.PME.max)*f.geral,b.totalString=g("largeNumber")(f.PME.max)+"\u20ac X "+100*f.PME.taxa+"% + "+g("largeNumber")(c-f.PME.max)+"\u20ac X "+100*f.geral+"%"):(b.total=c*f.PME.taxa,b.totalString=g("largeNumber")(c)+"\u20ac X "+100*f.PME.taxa+"%"):"excecoes"===a.tipo&&(b.total=c*f.excecoes,b.totalString=g("largeNumber")(c)+"\u20ac X "+100*f.excecoes+"%"),b.total=Math.round(100*b.total)/100):b=null;if(!e||b&&b.total<e.total)e=b;h=a.results.societario.contabilidadeOrganizada;c=a.rendimentos-
a.gastos;h.baseImposto=c;h.baseImpostoString=g("largeNumber")(a.rendimentos)+"\u20ac - "+g("largeNumber")(a.gastos)+"\u20ac";"geral"===a.tipo?(h.total=c*f.geral,h.totalString=g("largeNumber")(c)+"\u20ac X "+100*f.geral+"%"):"PME"===a.tipo?c>f.PME.max?(h.total=f.PME.max*f.PME.taxa+(c-f.PME.max)*f.geral,h.totalString=g("largeNumber")(f.PME.max)+"\u20ac X "+100*f.PME.taxa+"% + "+g("largeNumber")(c-f.PME.max)+"\u20ac X "+100*f.geral+"%"):(h.total=c*f.PME.taxa,h.totalString=g("largeNumber")(c)+"\u20ac X "+
100*f.PME.taxa+"%"):"excecoes"===a.tipo&&(h.total=c*f.excecoes,h.totalString=g("largeNumber")(c)+"\u20ac X "+100*f.excecoes+"%");h.total=Math.round(100*h.total)/100;if(!e||h&&h.total<e.total)e=h;e.isBest=!0;a.nSrS=k;a.nScO=m;a.srS=b;a.scO=h;a.best=e;console.log(a.results);a.loading=!1;return!0}return!1}"/resultado"===n.path()&&(n.path("/calculo"),a.loading=!1);return!1};p.get("./data.json").then(function(b){b.data&&(a.all=b.data,a.calculateResults())})});app.controller("indexCtrl",function(e){});
app.controller("calculoCtrl",function(e){});
app.controller("resultadoCtrl",function(e,a){a.loading=!0;a.calculateResults&&a.calculateResults();e.export=function(){html2canvas(document.getElementById("exportable"),{onrendered:function(a){a={content:[{image:a.toDataURL(),width:500}]};var e=new Date;timestamp=e.getFullYear().toString();timestamp+=(9>e.getMonth()?"0":"")+(e.getMonth()+1).toString();timestamp+=(10>e.getDate()?"0":"")+e.getDate().toString();timestamp+="_"+(10>e.getHours()?"0":"")+e.getHours().toString();timestamp+=(10>e.getMinutes()?
"0":"")+e.getMinutes().toString();pdfMake.createPdf(a).download("resultado-"+timestamp+".pdf")}})}});app.filter("largeNumber",function(){return function(e){e=e.toString().split(".");e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g," ");return e.join(".")}});